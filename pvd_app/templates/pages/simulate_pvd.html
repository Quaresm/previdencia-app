{% extends "layout/base.html" %} 
{% block stylesheets %}
<link rel="stylesheet" href="static/simulate_pvd.css">
{% endblock stylesheets %}
{% block content %}
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<section class="container">
    <div class="row">
        <h1 class="col title" >Simulação da previdência privada</h1>
    </div>
    <div class="row">
        <div class="col">
            <form>
                <div class="form-group">
                    <label class="alerta">Os valores financeiros devem ser em reais,<br>não há necessidade de preencher R$</label>
                </div>
                <div class="form-group">
                    <label for="initial_application">Aplicação Inicial:</label>
                    <input type="number" class="form-control" name="initial_application" id="initial_application" step="1" required>
                </div>
                <div class="form-group">
                    <label for="contributions_monthly">Aportes por mês:</label>
                    <input type="number" class="form-control" name="contributions_monthly" id="contributions_monthly" step="1" required>
                </div>
                <div class="form-group">
                    <label for="age_retireday">Quando pretende se aposentar:</label>
                    <input type="number" class="form-control" name="date_retireday" id="date_retireday" step="1" required>
                </div>
                <div class="form-group">
                    <label for="spent_monthly">Gasto Mensal após aposentadoria:</label>
                    <input type="number" class="form-control" name="spent_monthly" id="spent_monthly" step="1" required>
                </div>
                <div class="form-group">
                    <label for="bank">Escolha o banco de sua previdência:</label>
                    <select class="form-control" name="bank" id="bank" required>
                        <option value="" selected disabled></option>
                        <option value="Itau">Itaú</option>
                        <option value="Santander">Santander</option>
                        <option value="Bradesco">Bradesco</option>
                        <option value="Banco_do_Brasil">Banco do Brasil</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="application_type">Tipo de aplicação</label>
                    <select class="form-control" name="application_type" id="application_type" required>
                        <option value="" selected disabled></option>
                        <option value="fixed_income">Renda Fixa</option>
                        <option value="variable_income">Renda Variavél</option>
                        <option value="multi_market">Multimercado</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <label >Métodos de aposentadoria</label>
                        <div>
                            <input type="radio" class="form-check-input" id="PGBL" name="method_pgbl" value="PGBL" required>
                            <label class="form-check-label" for="PGBL">PGBL</label>
                        </div>
                        <div>
                            <input type="radio" class="form-check-input" id="VGBL" name="method_vgbl" value="VGBL" required>
                            <label class="form-check-label" for="VGBL">VGBL</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn">Calcular</button>
                </div>
            </form>
        </div>
        <div class="col">
            <canvas id="lineChart" width="700" height="650"></canvas>
        </div>
    </div>
</section>
<script>
    // Bloquear entrada de números decimais nos campos de entrada
    var inputs = document.querySelectorAll('input[type="number"]');
    inputs.forEach(function(input) {
        input.addEventListener('input', function() {
            this.value = this.value.replace(/[^\d]/, ''); // Remove qualquer coisa que não seja dígito
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
    var ctx = document.getElementById("lineChart").getContext("2d");
    var lineChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [], // Inicialmente vazio
            datasets: [
                {
                    label: "Data points",
                    data: [], // Inicialmente vazio
                    fill: false,
                    borderColor: "rgb(75, 192, 192)",
                    lineTension: 0.1
                }
            ]
        },
        options: {
            responsive: false
        }
    });
    // Função para atualizar o gráfico
    function updateChart(data) {
        lineChart.data.labels = data.labels;
        lineChart.data.datasets[0].data = data.values;
        lineChart.update();
    }

    // Interceptar o envio do formulário
    document.getElementById('pensionForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Evitar o envio padrão do formulário

        var formData = new FormData(this);

        // Enviar os dados ao backend usando fetch
        fetch('/calculate', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Atualizar o gráfico com os dados recebidos do backend
            updateChart(data);
        })
        .catch(error => console.error('Error:', error));
    });
</script>

{% endblock %}